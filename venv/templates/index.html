<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetaMask Connection</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #transactions {
            margin-top: 20px;
        }
        .transaction {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Connect to MetaMask</h1>
    <button id="connectButton">Connect to MetaMask</button>
    <p id="status"></p>

    <h2>Tracked Transactions</h2>
    <div id="transactions"></div>
    <button id="refreshButton">Refresh Transactions</button>

    <script>
        // MetaMask connection
        if (typeof window.ethereum !== 'undefined') {
            document.getElementById('status').innerText = 'MetaMask is available!';
        } else {
            document.getElementById('status').innerText = 'MetaMask is not installed!';
        }

        const connectButton = document.getElementById('connectButton');
        connectButton.addEventListener('click', async () => {
            try {
                const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                const account = accounts[0];
                document.getElementById('status').innerText = 'Connected as: ' + account;

                fetch('/track-address', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ address: account })
                }).then(response => response.json())
                  .then(data => alert('Address successfully tracked!'))
                  .catch(error => console.error('Error:', error));
            } catch (error) {
                console.error('Error connecting to MetaMask:', error);
            }
        });

        // Fetch transactions (poll every 10 seconds for new transactions)
        function loadTransactions() {
    fetch('/get-latest-transactions')  // Ensure this matches your Flask route
        .then(response => response.json())
        .then(data => {
            const transactionsDiv = document.getElementById('transactions');
            transactionsDiv.innerHTML = '';  // Clear previous transactions

            data.forEach(tx => {
                const txDiv = document.createElement('div');
                txDiv.className = 'transaction';
                txDiv.innerHTML = `
                    <p><strong>Transaction Hash:</strong> ${tx.hash}</p>
                    <p><strong>From:</strong> ${tx.from}</p>
                    <p><strong>To:</strong> ${tx.to}</p>
                    <p><strong>Value:</strong> ${tx.value} Wei</p>
                    <p><strong>Block Number:</strong> ${tx.blockNumber}</p>
                `;
                transactionsDiv.appendChild(txDiv);
            });
        })
        .catch(error => console.error('Error fetching transactions:', error));
}


        // Poll for new transactions every 10 seconds
        setInterval(loadTransactions, 10000);

        const refreshButton = document.getElementById('refreshButton');
        refreshButton.addEventListener('click', loadTransactions);
    </script>
</body>
</html>
